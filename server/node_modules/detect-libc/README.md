# detect-libc

<<<<<<< HEAD
Node.js module to detect details of the C standard library (libc)
implementation provided by a given Linux system.

Currently supports detection of GNU glibc and MUSL libc.

Provides asychronous and synchronous functions for the
family (e.g. `glibc`, `musl`) and version (e.g. `1.23`, `1.2.3`).

For previous v1.x releases, please see the
[v1](https://github.com/lovell/detect-libc/tree/v1) branch.
=======
Node.js module to detect the C standard library (libc) implementation
family and version in use on a given Linux system.

Provides a value suitable for use with the `LIBC` option of
[prebuild](https://www.npmjs.com/package/prebuild),
[prebuild-ci](https://www.npmjs.com/package/prebuild-ci) and
[prebuild-install](https://www.npmjs.com/package/prebuild-install),
therefore allowing build and provision of pre-compiled binaries
for musl-based Linux e.g. Alpine as well as glibc-based.

Currently supports libc detection of `glibc` and `musl`.
>>>>>>> 8c0793a0b6dd9fb0945195af8f9e82aab2b9dde0

## Install

```sh
npm install detect-libc
```

<<<<<<< HEAD
## API

### GLIBC

```ts
const GLIBC: string = 'glibc';
```

A String constant containing the value `glibc`.

### MUSL

```ts
const MUSL: string = 'musl';
```

A String constant containing the value `musl`.

### family

```ts
function family(): Promise<string | null>;
```

Resolves asychronously with:

* `glibc` or `musl` when the libc family can be determined
* `null` when the libc family cannot be determined
* `null` when run on a non-Linux platform

```js
const { family, GLIBC, MUSL } = require('detect-libc');

switch (await family()) {
  case GLIBC: ...
  case MUSL: ...
  case null: ...
}
```

### familySync

```ts
function familySync(): string | null;
```

Synchronous version of `family()`.

```js
const { familySync, GLIBC, MUSL } = require('detect-libc');

switch (familySync()) {
  case GLIBC: ...
  case MUSL: ...
  case null: ...
}
```

### version

```ts
function version(): Promise<string | null>;
```

Resolves asychronously with:

* The version when it can be determined
* `null` when the libc family cannot be determined
* `null` when run on a non-Linux platform

```js
const { version } = require('detect-libc');

const v = await version();
if (v) {
  const [major, minor, patch] = v.split('.');
}
```

### versionSync

```ts
function versionSync(): string | null;
```

Synchronous version of `version()`.

```js
const { versionSync } = require('detect-libc');

const v = versionSync();
if (v) {
  const [major, minor, patch] = v.split('.');
}
```

### isNonGlibcLinux

```ts
function isNonGlibcLinux(): Promise<boolean>;
```

Resolves asychronously with:

* `false` when the libc family is `glibc`
* `true` when the libc family is not `glibc`
* `false` when run on a non-Linux platform

```js
const { isNonGlibcLinux } = require('detect-libc');

if (await isNonGlibcLinux()) { ... }
```

### isNonGlibcLinuxSync

```ts
function isNonGlibcLinuxSync(): boolean;
```

Synchronous version of `isNonGlibcLinux()`.

```js
const { isNonGlibcLinuxSync } = require('detect-libc');

if (isNonGlibcLinuxSync()) { ... }
```

## Licensing

Copyright 2017, 2022 Lovell Fuller
=======
## Usage

### API

```js
const { GLIBC, MUSL, family, version, isNonGlibcLinux } = require('detect-libc');
```

* `GLIBC` is a String containing the value "glibc" for comparison with `family`.
* `MUSL` is a String containing the value "musl" for comparison with `family`.
* `family` is a String representing the system libc family.
* `version` is a String representing the system libc version number.
* `isNonGlibcLinux` is a Boolean representing whether the system is a non-glibc Linux, e.g. Alpine.

### detect-libc command line tool

When run on a Linux system with a non-glibc libc,
the child command will be run with the `LIBC` environment variable
set to the relevant value.

On all other platforms will run the child command as-is.

The command line feature requires `spawnSync` provided by Node v0.12+.

```sh
detect-libc child-command
```

## Integrating with prebuild

```json
  "scripts": {
    "install": "detect-libc prebuild-install || node-gyp rebuild",
    "test": "mocha && detect-libc prebuild-ci"
  },
  "dependencies": {
    "detect-libc": "^1.0.2",
    "prebuild-install": "^2.2.0"
  },
  "devDependencies": {
    "prebuild": "^6.2.1",
    "prebuild-ci": "^2.2.3"
  }
```

## Licence

Copyright 2017 Lovell Fuller
>>>>>>> 8c0793a0b6dd9fb0945195af8f9e82aab2b9dde0

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at [http://www.apache.org/licenses/LICENSE-2.0](http://www.apache.org/licenses/LICENSE-2.0.html)

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
